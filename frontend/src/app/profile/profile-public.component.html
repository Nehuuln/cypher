<div class="profile-page">
  <div class="profile-header-bar">
    <div class="header-info">
      <h2>Recherche</h2>
    </div>
  </div>

  <div class="public-profile-container">
    <div class="search-section">
      <div class="search-bar">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="#536471" style="margin-left: 12px">
          <path
            d="M10.25 3.75c-3.59 0-6.5 2.91-6.5 6.5s2.91 6.5 6.5 6.5c1.795 0 3.419-.726 4.596-1.904 1.178-1.177 1.904-2.801 1.904-4.596 0-3.59-2.91-6.5-6.5-6.5zm-8.5 6.5c0-4.694 3.806-8.5 8.5-8.5s8.5 3.806 8.5 8.5c0 1.986-.73 3.815-1.945 5.232l4.95 4.95-1.414 1.414-4.95-4.95C14.065 18.02 12.236 18.75 10.25 18.75c-4.694 0-8.5-3.806-8.5-8.5z"
          ></path>
        </svg>
        <input
          [(ngModel)]="tagInput"
          placeholder="Chercher un tag (ex: monTag_01)"
          class="search-input-field"
          (keydown.enter)="viewByTag()"
        />
      </div>
      <button (click)="viewByTag()" [disabled]="loading" class="action-btn search-btn">Voir</button>
    </div>

    <div *ngIf="loading" class="loading-msg">Chargement...</div>
    <div *ngIf="error" class="error-msg">{{ error }}</div>

    <div *ngIf="profile" class="profile-result-card">
      <div class="profile-cover"></div>

      <div class="profile-details-container">
        <div class="profile-top-row">
          <img
            *ngIf="avatarUrl"
            [src]="avatarUrl"
            class="profile-avatar-lg"
            crossorigin="use-credentials"
            (error)="$event.target.style.display = 'none'"
          />
          <div *ngIf="!avatarUrl" class="profile-avatar-lg" style="background: #e1e8ed"></div>

          <button *ngIf="isOwner()" class="edit-profile-btn" (click)="editProfile()">
            Éditer le profil
          </button>
        </div>

        <div class="profile-name">{{ profile.username }}</div>
        <div class="profile-handle">@{{ profile.tag }}</div>

        <div class="profile-bio" *ngIf="profile.bio">{{ profile.bio }}</div>

        <div class="profile-meta">
          <div class="meta-item">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path
                d="M7 4V3h2v1h6V3h2v1h1.5C19.89 4 21 5.12 21 6.5v12c0 1.38-1.11 2.5-2.5 2.5h-13C4.12 21 3 19.88 3 18.5v-12C3 5.12 4.12 4 5.5 4H7zm0 2H5.5c-.27 0-.5.22-.5.5v12c0 .28.23.5.5.5h13c.28 0 .5-.22.5-.5v-12c0-.28-.22-.5-.5-.5H17v1h-2V6H9v1H7V6zm0 6h2v-2H7v2zm0 4h2v-2H7v2zm4-4h2v-2h-2v2zm0 4h2v-2h-2v2zm4-4h2v-2h-2v2z"
              ></path>
            </svg>
            <span>Inscrit le {{ profile.createdAt | date : 'shortDate' }}</span>
          </div>
        </div>
      </div>

      <div class="profile-tabs">
        <div class="tab-item active">Publications</div>
      </div>

      <div class="profile-posts-list">
        <div
          *ngIf="posts.length === 0"
          style="padding: 20px; text-align: center; color: var(--text-secondary)"
        >
          Aucune publication pour le moment.
        </div>

        <div *ngFor="let p of posts" class="post">
          <div class="post-header">
            <img
              *ngIf="p.author"
              [src]="userAvatarUrl(p.author)"
              class="avatar"
              crossorigin="use-credentials"
              (error)="$event.target.style.display = 'none'"
            />

            <div class="author-info">
              <span class="username">{{ p.author?.username }}</span>
              <span class="handle">@{{ p.author?.tag }}</span>
              <span class="date">· {{ p.createdAt | date : 'd MMM' }}</span>
            </div>
          </div>

          <div class="post-content">
            <div class="text">{{ p.text }}</div>
          </div>

          <div *ngIf="p.media" class="post-media">
            <div class="media-wrapper">
              <img
                *ngIf="p.media.kind === 'image'"
                [src]="mediaUrl(p)"
                crossorigin="use-credentials"
                class="media-item"
              />
              <video
                *ngIf="p.media.kind === 'video'"
                [src]="mediaUrl(p)"
                controls
                class="media-item"
              ></video>
            </div>
          </div>

          <div class="post-footer">
            <div class="action-btn-icon" style="cursor: default">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path
                  d="M1.751 10c0-4.42 3.584-8 8.005-8h4.366c4.49 0 8.129 3.64 8.129 8.13 0 2.96-1.607 5.68-4.196 7.11l-8.054 4.46v-3.69h-.067c-4.49.1-8.183-3.51-8.183-8.01zm8.005-6c-3.317 0-6.005 2.69-6.005 6 0 3.37 2.77 6.08 6.138 6.01l.351-.01h1.761v2.3l5.087-2.81c1.951-1.08 3.163-3.13 3.163-5.36 0-3.39-2.744-6.13-6.129-6.13H9.756z"
                ></path>
              </svg>
              <span class="count">{{ p.comments?.length || 0 }}</span>
            </div>

            <button
              (click)="toggleLike(p)"
              [disabled]="likeProcessing[p._id]"
              class="action-btn-icon like-btn"
              [class.liked]="isLikedByMe(p)"
            >
              <span class="icon" *ngIf="!isLikedByMe(p)">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                  <path
                    d="M16.697 5.5c-1.222-.06-2.679.51-3.89 2.16l-.805 1.09-.806-1.09C9.984 6.01 8.526 5.44 7.304 5.5c-1.243.07-2.349.78-2.91 1.91-.552 1.12-.633 2.78.479 4.82 1.074 1.97 3.257 4.27 7.129 6.61 3.87-2.34 6.052-4.64 7.126-6.61 1.111-2.04 1.03-3.7.477-4.82-.561-1.13-1.666-1.84-2.908-1.91zm4.187 7.69c-1.351 2.48-4.001 5.12-8.379 7.67l-.503.3-.504-.3c-4.379-2.55-7.029-5.19-8.382-7.67-1.36-2.5-1.41-4.86-.514-6.67.887-1.79 2.647-2.91 4.601-3.01 1.651-.09 3.368.5 4.798 2.01 1.429-1.51 3.146-2.1 4.796-2.01 1.954.1 3.714 1.22 4.605 3.01.896 1.81.846 4.17-.514 6.67z"
                  ></path>
                </svg>
              </span>
              <span class="icon" *ngIf="isLikedByMe(p)">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="#f91880">
                  <path
                    d="M20.884 13.19c-1.351 2.48-4.001 5.12-8.379 7.67l-.503.3-.504-.3c-4.379-2.55-7.029-5.19-8.382-7.67-1.36-2.5-1.41-4.86-.514-6.67.887-1.79 2.647-2.91 4.601-3.01 1.651-.09 3.368.5 4.798 2.01 1.429-1.51 3.146-2.1 4.796-2.01 1.954.1 3.714 1.22 4.605 3.01.896 1.81.846 4.17-.514 6.67z"
                  ></path>
                </svg>
              </span>
              <span class="count">{{ (p.likesCount ?? p.likes?.length) || 0 }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
